#!/usr/bin/env node

var legacyCli = process.argv.indexOf('--legacy') >= 0

if (legacyCli) {
  require(`${__dirname}/../build/cli`).run(process.argv)
} else {
  const { spawn } = require('child_process');
  
  const rustBinary = spawn('./inspect-rs-cli', process.argv.slice(2));
  
  rustBinary.stdout.pipe(process.stdout);
  rustBinary.stderr.pipe(process.stderr);

  rustBinary.on('error', (err) => {
    console.error('Internal error; consider running with --legacy flag')

    console.error(err)
  });

  rustBinary.on('close', process.exit);
}
